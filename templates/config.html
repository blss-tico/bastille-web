{{define "content"}}
  <div class="card">
    {{$parentContext := .}} 
    {{range .Data.Commands}}
      {{if eq .Command "config"}}
        <h2>{{.Command}}</h2>
        <p class="card-description">{{.Description}}</p>
        <br />
        <form id="config-form" class="card-form">
          <label>Options:</label><br />
          {{range .Options}}
            <input type="checkbox" name="options_{{.Lflag}}" value="{{.Sflag}}" />
            <label for="{{.Lflag}}">{{.Lflag}}</label>
          {{end}}
          <br />
          {{range .Fields}}
            <br />
            {{if (or (eq . "get") (eq . "set") (eq . "add") (eq . "remove"))}}
              <input type="checkbox" name="action_{{.}}" value="{{.}}" />
              <label for="{{.}}">{{.}}</label>
            {{else}}
              <label>{{.}}</label><br />
              <input type="text" name="{{.}}" />
            {{end}}
            <br />
          {{end}}
          <br />
          <button class="btn-card-submit" onclick="configSubmit(event)">Submit</button>          
        </form>
        <br />
        <h3>Help</h3>
        <p class="card-help">{{.Help}}</p>
        {{range .Options}}
          <p>&nbsp;&nbsp;{{.Sflag}}&nbsp;|&nbsp;{{.Lflag}}&nbsp;-&nbsp;{{.Text}}</p>
        {{end}}
      {{end}}
    {{end}}
    <div class="card-results">
      <p id="result" class="card-result"></p>
      <p id="error" class="card-error"></p>
    </div>
  </div>

  <script>
    async function configSubmit(event) {
      event.preventDefault();

      const result = document.getElementById('result');
      const error = document.getElementById('error');
      result.innerText = "";
      error.innerText = ""; 
      
      const form = document.getElementById('config-form');
      const formData = new FormData(form);
      
      let options = [];
      let actions = [];
      let formObj = {};
      formData.forEach((value, key) => {
        if (key.indexOf('options_') != -1) {
          options.push(value);
          return;
        }

        if (key.indexOf('action_') != -1) {
          actions.push(value);
          return;
        }

        formObj[key] = value;
      });
      formObj['options'] = options.join(' ').trimEnd();
      formObj['action'] = actions.join(' ').trimEnd();
      const formJson = JSON.stringify(formObj);

      const response = await fetch('/config', {
        method: 'POST',
        headers: {
          'Access-Control-Allow-Origin': '*',
          'accept': 'application/json',
          'Content-Type': 'application/json',
          'X-Request-ID': sessionStorage.getItem('id')
        },
        body: formJson
      });
      
      if (!response.ok) {
        const err = new Error(`HTTP error! status: ${response.status}`);
        console.log('Error: ', err.message);
        result.innerText = "";
        error.innerText = await response.text();
        return;
      }

      const data = await response.json();
      result.innerText = data.msg;
      error.innerHTML = data.err;
      return data;
    }
  </script>
{{end}}
